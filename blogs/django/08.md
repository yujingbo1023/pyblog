---
title: 08-项目实战4
date: 2028-12-15
tags:
 - django
categories:
 -  django
---



# 订单交易平台

![image-20220710184409818](./assets/image-20220710184409818.png)

核心的功能模块：

- 认证模块，用户名密码 或 手机短信登录（60s有效）。

- 角色管理，不同角色具有不同权限 和 展示不同菜单。

  ```
  管理员，充值
    客户，下单
  ```

- **客户管理**，除了基本的增删改查以外，支持对客户可以分级，不同级别后续下单折扣不同。

- **交易中心**

  - 管理员可以给客户余额充值/扣费
  - **客户可以下单/撤单**
  - **生成交易记录**
  - 对订单进行多维度搜索，例如：客户姓名、订单号。

- worker，去执行订单并更新订单状态。



## 1.客户管理

- 客户列表

  - 读取客户列表，页面展示。

  - 问题：如果关联的级别被删除呢？

    ```
    - 删除级别时，判断下属如果还有数据，则不允许被删除。
    - 自动将级别设置为某个级别。
    - 将级别设置为空。
    ```

  - 模板的时间格式

  - 主动连表查询

    ```
    queryset = models.Customer.objects.filter(active=1).select_related('level')
    ```

- 新建客户

  - 新增重复密码字段

  - 展示管理级别 - 数据源

    - models中的limit_choice_to

    - 自定义choices和queryset

      ```
      queryset = models.Level.objects.filter(active=1).order_by("percent")
      ```

  - 展示管理级别 - 页面插件（select -> radio）

  - 提交保存

    - models表单验证，正则validators
    - 自定义钩子，确保密码一致

  - 跳转回页面

- 编辑客户（部分信息）

  - 单独再创建一个ModelForm

- 重置密码

- 删除客户（对话框和Ajax）

- 分页

- 新建 & 编辑 跳转回来时的链接问题。

- Q对象搜索



## 2.价格策略

- 列表
- 编辑，对话框
- 添加，对话框
- 删除，对话框



## 3.客户下单

- 我的订单

- 下单

  - 展示价格策略和选择

  - 事务处理 & 锁

    ```
    创建订单
    扣款
    生成交易记录
    订单放入队列
    ```

- 撤单

  ```
  如果是待执行，可以撤单（事务处理 & 锁）
  退款
  生成交易记录
  ```

  

























